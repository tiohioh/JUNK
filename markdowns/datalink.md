# ネットワーク実験I データリンク層[4-1]

# 1. レポート課題

## 1.1 データリンク層


データリンク層はOSI参照モデルにおいて物理層の次に上位にある層で、同じネットワーク内に接続された隣接ノード間の通信について規定されている。

|階層|階層名|
|---|----|
|第7層|アプリケーション層|
|第6層|プレゼンテーション層|
|第5層|セッション層|
|第4層|トランスポート層|
|第3層|ネットワーク層|
|第2層|データリンク層|
|第1層|物理層|

表1.1.1 OSI参照モデル

データリンク層ではネットワーク内の通信について定められていてMACアドレス等のアドレスによりパケットの転送制御が行われる。

## 1.2 MACアドレス

MAC(media access control)アドレスはデータリンク層にて規定されている識別子で同一ネットワーク内の機器を識別するために利用されている。


図1.2.1 Android OSにおけるMACアドレス表記

MACアドレスの長さは6Byteと規定されていて、一般には図1.2.1のような1Byteごとに区切って表記を行う。
先頭の3ByteがOUI(Organizationally Unique Identifier)、後方3Byteが固有製造番号と規定されている。
MACアドレスはその性質上ユニークな値であることが必要であるためIEEEがOUIを管理している。ベンダはIEEEに割当および登録のための料金を支払うことでOUIの割当を受けることができる。

## 1.3 ブリッジ

### 1.3.1 ブリッジの動作

ブリッジは同一ネットワーク内のセグメント間においてデータリンク層で規定されているMACアドレスを読み込み、ブリッジ内で保持しているMACアドレステーブルを参照し、送信の可否を判断した上でリピートする機器である。

リピーターとは異なり必要なパケットのみ転送するため、無駄なトラフィックを発生させずネットワーク利用率を低下させることができる。また、セグメントの分割によりコリジョンの検出が容易になる。

### 1.3.2 ブリッジとスイッチングハブの違い

ブリッジは2つのセグメントの転送制御をするものであったが、スイッチングハブはそれ以上のセグメントに対応する。また、製品によってはブロードキャストストリームを防止する機能があるものも存在する。

## 1.4 ARP(概念と仕組み)

ARP(Address Resolution Protol)はネットワーク層に規定されているIPとデータリンク層に規定されているMACアドレスの紐づけに使用する通信プロトコルである。
ローカルネットワークにおける情報転送においてはデータリンク層のMACアドレスにより転送制御を実施するため、IPアドレスとMACアドレスの転送は不可欠である。

ARPではMACアドレスを取得したいIPアドレスが有効なARPキャッシュにないとき、MACアドレスを必要とするIPアドレスをネットワーク全体にブロードキャスト送信し該当のIPアドレスを保持している機器に対してMACアドレスを返信するように要求する。
これをARPリクエストという。
ARPリクエストを送る段階では送信先のMACアドレスが不明であるため、"ff:ff:ff:ff:ff:ff"のブロードキャストアドレスが用いられる。

ARPリクエストを逐次的に行うとトラフィックが膨大となり非効率となるため、ARPリクエストにより取得したペアをARPキャッシュと呼ばれるテーブルに保管する。
このテーブルにはIPアドレスとMACアドレスが保管されていて、一定の時間以内に同一のIPアドレスが再度参照された場合にはARPリクエストを行わずARPテーブルを参照してMACアドレスの特定を行う。

```plantuml
title ARPリクエストのフロー(例)

participant "192.168.11.1" as host
participant "192.168.11.8" as device_1
participant "192.168.11.9" as device_2
participant "192.168.11.10" as device_3

host->device_1:IPアドレスが192.168.11.9の端末は応答せよ
note over device_1:IPアドレスが一致しないので無視
host->device_2:IPアドレスが192.168.11.9の端末は応答せよ
note over device_2:IPアドレスが一致したのでMACを返却
device_2->host:MACアドレスは01:23:45:67:89:ABです。
host->device_3:IPアドレスが192.168.11.9の端末は応答せよ
note over device_3:IPアドレスが一致しないので無視
```

```cmd
C:\Users\***->arp -a | findstr /c:"  192.168.63."
  192.168.63.1          **-**-**-54-9a-80     動的
  192.168.63.4          **-**-**-0f-ba-91     動的
  192.168.63.38         **-**-**-51-ea-b8     動的
  192.168.63.39         **-**-**-7f-51-ac     動的
  192.168.63.116        **-**-**-c0-2e-dd     動的
  192.168.63.140        **-**-**-c4-5c-4c     動的
  192.168.63.255        ff-ff-ff-ff-ff-ff     静的
```
*図1.4.1 windowsのコマンドプロンプトにおけるarpコマンドの実行例(一部マスクしてある)*

ARPキャッシュは図1.4.1のように"arp"コマンドにより確認することができる。

# 2. その他

## 2.1 実験に関して



## 2.2 レポート提出に関して

本レポートのpdfファイルのファイル名が"{学籍番号}.pdf"に指定されているが、他の実験においても同様なファイル名が指定されてしまう場合ファイル名の重複が発生する。
ファイルの管理を簡略化するためにも、作成し個人で管理するファイル名と提出するファイル名を同一のものとしたいため、"ネットワーク実験_{実験番号}-{回数}_{学籍番号}.pdf"()のような名前がユニークでかつ提出物の内容が自明であるファイル名に指定してほしい。

# 3. 参考文献

- 応用情報技術者合格教本, 大滝みや子、岡嶋祐史, 技術評論社
- ネットワーク技術の基礎, 宮保憲治、田窪昭夫、武田直樹、八槇博史, 森北出版

https://jp.ieee.org/procedure/files/JP_Order%20guide_MAC%20address_revise_2019_v1.pdf

https://datatracker.ietf.org/doc/html/rfc826 ARPの定義
