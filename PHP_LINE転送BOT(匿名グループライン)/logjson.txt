{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[]}\n{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"follow","timestamp":1644890968084,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"d72320f3e249442aa532bbb288c4d271","mode":"active"}]}\n{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"unfollow","timestamp":1644891541067,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"follow","timestamp":1644891543289,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"dc763da494c145c2b6e3d917f6264367","mode":"active"}]}\n{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"unfollow","timestamp":1644891567657,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"follow","timestamp":1644892946015,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"901911f8311a43ee920c96a5f2cf961b","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"unfollow","timestamp":1644898987045,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"follow","timestamp":1644899012918,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"0e3faafea91f43ab801c98c244f64478","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"unfollow","timestamp":1644899106268,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"follow","timestamp":1644899107537,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"6ef4ae298c1347dd9b3547567aa61fe1","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15592241453270","contentProvider":{"type":"line"}},"timestamp":1644903285135,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"305fce6dd49c4a99bea97703da469b3e","mode":"active"}]}

{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15592270208591","contentProvider":{"type":"line"}},"timestamp":1644903662808,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"3d7b9dc3182949cba58d5ec5087efc61","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15592328145385","contentProvider":{"type":"line"}},"timestamp":1644904423765,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"064aeeb2b65141a7a6fe35b91136620d","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15592333957625","contentProvider":{"type":"line"}},"timestamp":1644904499730,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"f59672f8c691404a9585c2321cf25320","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15592338615172","contentProvider":{"type":"line"}},"timestamp":1644904560360,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"02ebb7b68fec4256a491f7f74c49a21a","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15592350428513","contentProvider":{"type":"line"}},"timestamp":1644904713308,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"894b0755611747dfb9163ccb151f8802","mode":"active"}]}





{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15596688229606","contentProvider":{"type":"line"}},"timestamp":1644973017813,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"5347ddef2f6041e0bd8107a6d633fd8d","mode":"active"}]}

{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15596775320651","contentProvider":{"type":"line"}},"timestamp":1644974282201,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"87152f90277e4117bc264099c80211e6","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15596802021969","text":"<?php\n$LINE_ACCESS_TOKEN = 'A19ZPqanfja51vD2D16HLGGMLAaIBqx/kvPnKQEw+BnFKfGJOGop/0k8K+GkSyhzdbqoWmNlxuGLFgqrB6xIFl0Od8VdA/4s2iIsSwITBu8cvLeLXwdUwkYMglij2qPBMZpXNGsXar4dIpp9BLZBXQdB04t89/1O/w1cDnyilFU=';\n$LINE_ACCESS_TOKEN = 'Bearer ' . $LINE_ACCESS_TOKEN;\n\n$meta = file_get_contents('php://input');\n$body = json_decode($meta);\n//本来は複数のWebhookについて考慮しないといけないが、この実装では無視する\n$request_type = $body->events[0]->type;\n//とりあえず、テキストのみ対応にする(画像対応は画像を取得するためにリクエストを投げる必要があるので面倒)\n\n//log 保存\nfile_put_contents('./logjson.txt',$meta.\"\\n\",FILE_APPEND);\n\nif($request_type == \"follow\"){\n$userID = $body->events[0]->source->userId;\n$token = $body->events[0]->replyToken;\nfile_put_contents('./user_id.txt',$userID.\"\\n\",FILE_APPEND);\n$return_text = \"お友達追加ありがとうございます。\\n匿名送信ボットです。このチャットボットに送ったメッセージはこのチャットボットと友達になっている全ての人に再送されます。送った人や受けとる人は利用者からは分かりません。\\nこの匿名トークルームには送信取り消し機能はありません。ご注意ください。\";\nreply_message($token,$return_text);\n}elseif($request_type == 'unfollow'){\n//remove userid from database\n$userID = $body->events[0]->source->userId;\n$write = str_replace($userID.\"\\n\",'',file_get_contents('./user_id.txt'));\nfile_put_contents('./user_id.txt',$write);\n}elseif($request_type == 'message'){\n$message_type = $body->events[0]->message->type;\nif($message_type == 'text'){\n//メッセージの送信処理->送った人以外に送付\n$message = $body->events[0]->message->text;\n$userID = $body->events[0]->source->userId;\n$userIDs = explode(file_get_contents('./user_id.txt'));\nfor($i = 0;$i < count(userIDs);$i += 1){\nif($userID != $userIDs[$i] && $userIDs[$i] != ''){\nsend_message($userIDs[$i],$message);\n}\n}\n}else{\n$return_text = \"このメッセージタイプはサポートされていません。\\n$message_type = {$message_type}\\n\";\n$token = $body->events[0]->replyToken;\nreply_message($token,$return_text);\n}\n}else{\n$return_text = \"このイベントタイプは処理されません。\\n$request_type = {$request_type}\\n\";\n$token = $body->events[0]->replyToken;\nreply_message($token,$return_text);\n}\n+\n\nhttp_response_code(200);\n\nfunction send_message($toID,$message){\nglobal $LINE_ACCESS_TOKEN;\necho $LINE_ACCESS_TOKEN;\n$LINE_PUSH_URL = 'https://api.line.me/v2/bot/message/push';\n\n$header = 'Authorization: '.$LINE_ACCESS_TOKEN.\"\\n\";\n$header .= 'Content-Type: application/json';\n\n$body = array(\n'to' => $toID,\n'messages' => array(\n'type' => 'text',\n'text' => $message\n)\n);\n\n$context = stream_context_create(array(\n'http' => array(\n'method' => 'post',\n'content'=> json_encode($body),\n'header' => $header,\n'ignore_errors' => true\n)\n));\n\n$result = file_get_contents($LINE_PUSH_URL, false,$context);\nfile_put_contents('./sample.txt',json_encode($context).\"\\n\",FILE_APPEND);\n}\n\nfunction reply_message($replayID,$message){\nglobal $LINE_ACCESS_TOKEN;####合ってる？\necho $LINE_ACCESS_TOKEN;\n$LINE_PUSH_URL = 'https://api.line.me/v2/bot/message/reply';\n\n$header = 'Authorization: '.$LINE_ACCESS_TOKEN.\"\\n\";\n$header .= 'Content-Type: application/json';\n\n$body = array(\n'replyToken' => $replayID,\n'messages' => array(\n'type' => 'text',\n'text' => $message\n)\n);\n$context = array(\n'http' => array(\n'method' => 'post',\n'content' => json_encode($body),\n'header' => $header,\n'ignore_errors' => true\n)\n);\n$result = file_get_contents($LINE_PUSH_URL,false,stream_context_create($context));\nfile_put_contents('./sample.txt',($context['http']['content']).\"\\n\",FILE_APPEND);\n}\n?>"},"timestamp":1644974688163,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"2f3446da40494317853429e0b3232980","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15596802903804","contentProvider":{"type":"line"}},"timestamp":1644974701748,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"fb19a5585b5748b7a8917182a05fdc59","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15596832859173","contentProvider":{"type":"line"}},"timestamp":1644975161067,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"a2df59eeb86f40ddad3a393ec32d1865","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15596845077931","contentProvider":{"type":"line"}},"timestamp":1644975348794,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"a7215234e06b4627b498f511c36b6925","mode":"active"}]}

{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600527518549","contentProvider":{"type":"line"}},"timestamp":1645023999579,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"86cb406fa9d148079297606788d81211","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600538137387","contentProvider":{"type":"line"}},"timestamp":1645024164207,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"783e246996374784a355aa85d0514501","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600540535012","contentProvider":{"type":"line"}},"timestamp":1645024201606,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"1ced92e2e702445faa179f63fa0ead30","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600546217711","contentProvider":{"type":"line"}},"timestamp":1645024290943,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"ebcf6d205b4c49e09ef8b4bf675335ba","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600552647990","contentProvider":{"type":"line"}},"timestamp":1645024392165,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"b2f85bbf556b4127b5c8f3433bb2343f","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600555249851","contentProvider":{"type":"line"}},"timestamp":1645024433304,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"b4636860cdd54b18ac59c6e73cbf04ec","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600563054477","contentProvider":{"type":"line"}},"timestamp":1645024558097,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"2ee5b666e84a44ae85a62a42a12f70c1","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600566754327","contentProvider":{"type":"line"}},"timestamp":1645024617764,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"e052f0331d35458d9450c34a895d34bb","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600571923452","contentProvider":{"type":"line"}},"timestamp":1645024701555,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"28024f57da3e462eaaa39b0d525635c8","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600580340795","contentProvider":{"type":"line"}},"timestamp":1645024839339,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"2fe99325989d42dabf3fff35908b7313","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600581522858","contentProvider":{"type":"line"}},"timestamp":1645024858685,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"b95f876ea9b94a78bae0565dcab15684","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600584985715","contentProvider":{"type":"line"}},"timestamp":1645024915796,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"e4918cd8e33148a3b1e35629cd994cea","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"unfollow","timestamp":1645024970170,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"follow","timestamp":1645024982792,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"b579757e13a041e09f16e729309241f8","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"unfollow","timestamp":1645025018893,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"follow","timestamp":1645025019646,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"613e6e38313647258e5338a3d95b40a9","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"location","id":"15600594602574","latitude":35.689642,"longitude":139.692101,"address":"日本、〒160-0023 東京都新宿区西新宿２丁目８ 都庁通り"},"timestamp":1645025074897,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"2172aea50d1446b3af0fc1f2d16eb48c","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600596093308","contentProvider":{"type":"line"}},"timestamp":1645025099925,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"fb048a4771704904887726f547ad93b7","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600600814046","contentProvider":{"type":"line"}},"timestamp":1645025179154,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"2d24dba606e240cdb975a40cbadaf322","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"image","id":"15600601198645","contentProvider":{"type":"line"}},"timestamp":1645025185620,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"9b53962fa13b4b6b978276fb179e63ad","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600648430013","text":"こんにちは"},"timestamp":1645025999054,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"3adf0f1868cb4233b1fd6332a305e388","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"join","timestamp":1645026487948,"source":{"type":"group","groupId":"Caa52c2d9816c0ffd5e2cd9127ffbb0f1"},"replyToken":"ef6cd722181245fabecdb64e100ddf47","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600679880478","text":"テスト"},"timestamp":1645026562848,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"8d061ef93c124c7b8fef5c80109c59f6","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600681438177","text":"テスト"},"timestamp":1645026591332,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"340f49e15ef0498bad2b79c0b5a9de44","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600687023966","text":"テスト"},"timestamp":1645026693482,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"a0b2d953644145c4b20c3f03a1bf14e8","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600693857793","text":"テスト"},"timestamp":1645026819268,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"3b607fa57a054536a57eace608893c26","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600714575519","text":"テスト"},"timestamp":1645027205004,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"0b6855c6292d4eec85ca79286b86528f","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600716747669","text":"テスト"},"timestamp":1645027245218,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"e6acbe776876430695217a6a88446292","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600722147231","text":"テスト"},"timestamp":1645027346257,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"539757388ea6442293d0c9891c4cd054","mode":"active"}]}
{"destination":"U5a04ee387aacd387129d02a25462de2f","events":[{"type":"message","message":{"type":"text","id":"15600738303247","text":"テスト"},"timestamp":1645027653066,"source":{"type":"user","userId":"Uc7b19ead356e0da00f69529620ba1f83"},"replyToken":"3c99af52bfc24d898dd6706da83ea260","mode":"active"}]}
